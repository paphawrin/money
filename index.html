<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bill Splitter</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    * {
      box-sizing: border-box;
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.2);
    }

    .card-hover:hover {
      transform: translateY(-2px);
      transition: transform 0.2s ease;
    }

    .checkbox-custom {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #fb923c;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-content {
      max-width: 900px;
      max-height: 90%;
      overflow-y: auto;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app-wrapper" class="w-full min-h-full"></div>
  <script>
    const defaultConfig = {
      background_color: "#fef3c7",
      surface_color: "#ffffff",
      text_color: "#1e293b",
      primary_action_color: "#fb923c",
      secondary_action_color: "#ec4899",
      app_title: "üí∞ ‡πÅ‡∏ö‡πà‡∏á‡∏ö‡∏¥‡∏•",
      app_subtitle: "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢ ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ‡∏´‡∏≤‡∏£‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
      total_amount_label: "üíµ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)",
      people_section_title: "üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°",
      add_person_button: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô",
      items_section_title: "üçΩÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄÔøΩÔøΩ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°",
      add_item_button: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
      calculate_button: "üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì",
      reset_button: "üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï",
      summary_title: "üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
      view_summary_button: "üìã ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ",
      contact_title: "üìû ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠",
      contact_method_1: "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
      contact_detail_1: "0xx-xxx-xxxx",
      contact_method_2: "Line ID",
      contact_detail_2: "@yourlineid",
      font_family: "Inter",
      font_size: 16
    };

    let people = [];
    let items = [];
    let totalAmount = 0;
    let showSummaryModal = false;
    let currentView = 'main'; // 'main', 'payment', 'contact', 'summary'
    let paymentMethods = [
      { id: 1, name: 'PromptPay', detail: '0xx-xxx-xxxx', icon: 'üí≥' },
      { id: 2, name: '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£', detail: '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤ÔøΩÔøΩÔøΩ‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µÔøΩÔøΩÔøΩ xxx-x-xxxxx-x', icon: 'üè¶' },
      { id: 3, name: 'True Money Wallet', detail: '0xx-xxx-xxxx', icon: 'üí∞' }
    ];

    let contactMethods = [
      { id: 1, name: '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', detail: '0xx-xxx-xxxx' },
      { id: 2, name: 'Line ID', detail: '@yourlineid' },
      { id: 3, name: 'Facebook', detail: 'facebook.com/yourpage' }
    ];

    function addPerson() {
      const personId = Date.now();
      people.push({
        id: personId,
        name: `‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${people.length + 1}`
      });
      renderPeople();
      renderItems();
    }

    function removePerson(personId) {
      people = people.filter(p => p.id !== personId);
      items.forEach(item => {
        item.consumers = item.consumers.filter(id => id !== personId);
      });
      renderPeople();
      renderItems();
    }

    function updatePersonName(personId, name) {
      const person = people.find(p => p.id === personId);
      if (person) {
        person.name = name;
        renderItems();
      }
    }

    function addItem() {
      const itemId = Date.now();
      items.push({
        id: itemId,
        name: '',
        price: 0,
        type: 'food',
        consumers: []
      });
      renderItems();
    }

    function removeItem(itemId) {
      items = items.filter(i => i.id !== itemId);
      renderItems();
    }

    function updateItemName(itemId, name) {
      const item = items.find(i => i.id === itemId);
      if (item) {
        item.name = name;
      }
    }

    function updateItemPrice(itemId, price) {
      const item = items.find(i => i.id === itemId);
      if (item) {
        item.price = parseFloat(price) || 0;
      }
    }

    function updateItemType(itemId, type) {
      const item = items.find(i => i.id === itemId);
      if (item) {
        item.type = type;
        renderItems();
      }
    }

    function toggleConsumer(itemId, personId) {
      const item = items.find(i => i.id === itemId);
      if (item) {
        const index = item.consumers.indexOf(personId);
        if (index > -1) {
          item.consumers.splice(index, 1);
        } else {
          item.consumers.push(personId);
        }
        renderItems();
      }
    }

    function addPaymentMethod() {
      const newId = Math.max(...paymentMethods.map(p => p.id), 0) + 1;
      paymentMethods.push({
        id: newId,
        name: '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà',
        detail: '',
        icon: 'üíµ'
      });
      renderPaymentMethodsEdit();
    }

    function removePaymentMethod(id) {
      if (paymentMethods.length <= 1) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        showToast('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }
      paymentMethods = paymentMethods.filter(p => p.id !== id);
      renderPaymentMethodsEdit();
    }

    function updatePaymentMethod(id, field, value) {
      const method = paymentMethods.find(p => p.id === id);
      if (method) {
        method[field] = value;
      }
    }

    function addContactMethod() {
      const newId = Math.max(...contactMethods.map(c => c.id), 0) + 1;
      contactMethods.push({
        id: newId,
        name: '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà',
        detail: ''
      });
      renderContactMethodsEdit();
    }

    function removeContactMethod(id) {
      if (contactMethods.length <= 1) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        showToast('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }
      contactMethods = contactMethods.filter(c => c.id !== id);
      renderContactMethodsEdit();
    }

    function updateContactMethod(id, field, value) {
      const method = contactMethods.find(c => c.id === id);
      if (method) {
        method[field] = value;
      }
    }

    function renderPaymentMethodsEdit() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const container = document.getElementById('payment-methods-container');
      if (!container) return;

      let html = '';
      paymentMethods.forEach((method, index) => {
        html += `
          <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 16px; animation-delay: ${index * 0.1}s;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; margin: 0;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ${index + 1}</h3>
              ${paymentMethods.length > 1 ? `
                <button 
                  onclick="removePaymentMethod(${method.id})"
                  style="padding: 8px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
                >üóëÔ∏è ‡∏•‡∏ö</button>
              ` : ''}
            </div>

            <div style="margin-bottom: 16px;">
              <label for="payment-name-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 8px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label>
              <input 
                id="payment-name-${method.id}"
                type="text" 
                value="${method.name}"
                onchange="updatePaymentMethod(${method.id}, 'name', this.value)"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô PromptPay, ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, True Money"
                style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
              />
            </div>

            <div>
              <label for="payment-detail-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
              <textarea 
                id="payment-detail-${method.id}"
                onchange="updatePaymentMethod(${method.id}, 'detail', this.value)"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, QR Code"
                rows="2"
                style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; resize: vertical;"
              >${method.detail}</textarea>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderContactMethodsEdit() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const container = document.getElementById('contact-methods-container');
      if (!container) return;

      let html = '';
      contactMethods.forEach((method, index) => {
        html += `
          <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 16px; animation-delay: ${index * 0.1}s;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; margin: 0;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ${index + 1}</h3>
              ${contactMethods.length > 1 ? `
                <button 
                  onclick="removeContactMethod(${method.id})"
                  style="padding: 8px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
                >üóëÔ∏è ‡∏•‡∏ö</button>
              ` : ''}
            </div>

            <div style="margin-bottom: 16px;">
              <label for="contact-name-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 8px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label>
              <input 
                id="contact-name-${method.id}"
                type="text" 
                value="${method.name}"
                onchange="updateContactMethod(${method.id}, 'name', this.value)"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, Line ID, Facebook, Email"
                style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
              />
            </div>

            <div>
              <label for="contact-detail-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
              <textarea 
                id="contact-detail-${method.id}"
                onchange="updateContactMethod(${method.id}, 'detail', this.value)"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, Line ID, ‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
                rows="2"
                style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; resize: vertical;"
              >${method.detail}</textarea>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderPaymentMethodsModal() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      let html = '';
      
      paymentMethods.forEach((method, index) => {
        html += `
          <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
              <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px;">${method.icon}</span>
              <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700;">${method.name}</span>
            </div>
            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 12px 16px; border-radius: 6px; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; word-break: break-word;">
              ${method.detail}
            </div>
          </div>
        `;
      });

      return html;
    }

    function renderContactMethodsModal() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      let html = '';
      
      contactMethods.forEach((method, index) => {
        html += `
          <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">${method.name}</div>
            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 12px 16px; border-radius: 6px; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; word-break: break-word;">
              ${method.detail}
            </div>
          </div>
        `;
      });

      return html;
    }

    function openSummaryModal() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const totalInput = document.getElementById('total-amount');
      if (totalInput) {
        totalAmount = parseFloat(totalInput.value) || 0;
      }

      if (totalAmount <= 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }

      if (people.length === 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }

      currentView = 'summary';
      renderApp();
    }

    function closeSummaryModal() {
      currentView = 'main';
      renderApp();
    }

    function openPaymentPage() {
      currentView = 'payment';
      renderApp();
    }

    function savePaymentInfo() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏πÔøΩÔøΩÔøΩ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úì', config.primary_action_color || defaultConfig.primary_action_color);
      currentView = 'main';
      renderApp();
    }

    function backToMain() {
      currentView = 'main';
      renderApp();
    }

    function openContactPage() {
      currentView = 'contact';
      renderApp();
    }

    function saveContactInfo() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úì', config.secondary_action_color || defaultConfig.secondary_action_color);
      currentView = 'main';
      renderApp();
    }

    function renderSummaryPage() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      let itemsTotal = 0;
      items.forEach(item => {
        itemsTotal += item.price;
      });

      const sharedAmount = totalAmount - itemsTotal;
      const perPersonShared = sharedAmount / people.length;

      let summaryHtml = `
        <main style="max-width: 1000px; margin: 0 auto;">
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
            <div style="display: flex; align-items: center; margin-bottom: 32px;">
              <button 
                onclick="closeSummaryModal()"
                style="width: 44px; height: 44px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: none; border-radius: 50%; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0;"
              >‚Üê</button>
              <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">${config.summary_title || defaultConfig.summary_title}</h1>
            </div>

            <div style="background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}15, ${config.secondary_action_color || defaultConfig.secondary_action_color}15); border-radius: 12px; padding: 24px; margin-bottom: 32px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin-bottom: 8px; font-weight: 600;">üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
              <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2.5}px; font-weight: 800;">${totalAmount.toFixed(2)} ‡∏ø</div>
            </div>

            <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
              <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0 0 20px 0;">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (${people.length} ‡∏Ñ‡∏ô)</h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">
      `;

      people.forEach((person, index) => {
        summaryHtml += `
          <div style="background: white; padding: 14px; border-radius: 8px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; flex-shrink: 0;">${index + 1}</span>
            <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${person.name}</span>
          </div>
        `;
      });

      summaryHtml += `
              </div>
            </div>

            <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
              <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0 0 20px 0;">üçΩÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (${items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
      `;

      if (items.length === 0) {
        summaryHtml += `
          <div style="text-align: center; padding: 40px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; margin-bottom: 8px;">üçΩÔ∏è</div>
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
          </div>
        `;
      } else {
        items.forEach((item, index) => {
          const icon = item.type === 'food' ? 'üçΩÔ∏è' : 'ü•§';
          const consumerNames = item.consumers.map(cid => {
            const p = people.find(person => person.id === cid);
            return p ? p.name : '';
          }).filter(n => n).join(', ');

          summaryHtml += `
            <div style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                <div style="flex: 1;">
                  <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 4px;">
                    <span style="margin-right: 8px;">${icon}</span>${item.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}
                  </div>
                  <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; opacity: 0.7;">
                    ${consumerNames || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á'}
                  </div>
                </div>
                <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; white-space: nowrap; margin-left: 16px;">
                  ${item.price.toFixed(2)} ‡∏ø
                </div>
              </div>
            </div>
          `;
        });

        summaryHtml += `
          <div style="background: white; padding: 16px; border-radius: 8px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700;">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>
              <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800;">${itemsTotal.toFixed(2)} ‡∏ø</span>
            </div>
          </div>
        `;
      }

      summaryHtml += `
            </div>

            <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0;">üí≥ ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
              </div>
              ${renderPaymentMethodsModal()}
            </div>

            <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0;">üìû ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
              </div>
              ${renderContactMethodsModal()}
            </div>

            <div style="text-align: center;">
              <button 
                onclick="closeSummaryModal()"
                style="padding: 16px 40px; background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color}); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 800; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
              >‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
          </div>
        </main>
      `;

      return summaryHtml;
    }

    function calculateSplit() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const totalInput = document.getElementById('total-amount');
      totalAmount = parseFloat(totalInput.value) || 0;

      if (totalAmount <= 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }

      if (people.length === 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô', config.secondary_action_color || defaultConfig.secondary_action_color);
        return;
      }

      let itemsTotal = 0;
      items.forEach(item => {
        itemsTotal += item.price;
      });

      const sharedAmount = totalAmount - itemsTotal;
      const perPersonShared = sharedAmount / people.length;

      const results = people.map(person => {
        let personItemsTotal = 0;
        const personItems = [];

        items.forEach(item => {
          if (item.consumers.includes(person.id)) {
            const itemPerPerson = item.price / item.consumers.length;
            personItemsTotal += itemPerPerson;
            personItems.push({
              name: item.name,
              type: item.type,
              price: itemPerPerson,
              totalPrice: item.price,
              sharedWith: item.consumers.length
            });
          }
        });

        const personTotal = personItemsTotal + perPersonShared;
        return {
          name: person.name,
          items: personItems,
          itemsTotal: personItemsTotal,
          sharedAmount: perPersonShared,
          total: personTotal
        };
      });

      displayResults(results);
    }

    function displayResults(results) {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const resultsContainer = document.getElementById('results-container');
      
      let html = `
        <div class="fade-in" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 28px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); margin-top: 32px;">
          <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.75}px; font-weight: 800; margin: 0 0 24px 0; text-align: center;">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
          <div style="background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}15, ${config.secondary_action_color || defaultConfig.secondary_action_color}15); border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
            <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin-bottom: 8px; font-weight: 600;">üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2.25}px; font-weight: 800;">${totalAmount.toFixed(2)} ‡∏ø</div>
          </div>
      `;

      results.forEach((result, index) => {
        html += `
          <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid ${config.primary_action_color || defaultConfig.primary_action_color}; animation-delay: ${index * 0.1}s;">
            <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center;">
              <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 12px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">${index + 1}</span>
              ${result.name}
            </div>
        `;

        if (result.items.length > 0) {
          html += `
            <div style="margin-bottom: 12px; background: white; padding: 12px; border-radius: 8px;">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; margin-bottom: 12px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á:</div>
          `;
          
          result.items.forEach(item => {
            const icon = item.type === 'food' ? 'üçΩÔ∏è' : 'ü•§';
            const shareText = item.sharedWith > 1 ? ` (‡πÅ‡∏ö‡πà‡∏á ${item.sharedWith} ‡∏Ñ‡∏ô)` : '';
            html += `
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed ${config.background_color || defaultConfig.background_color};">
                <div>
                  <span style="margin-right: 8px;">${icon}</span>
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">${item.name}${shareText}</span>
                </div>
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${item.price.toFixed(2)} ‡∏ø</span>
              </div>
            `;
          });
          
          html += `
              <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid ${config.background_color || defaultConfig.background_color}; display: flex; justify-content: space-between;">
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700;">${result.itemsTotal.toFixed(2)} ‡∏ø</span>
              </div>
            </div>
          `;
        }

        html += `
            <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πàÔøΩÔøΩÔøΩ‡∏ô‡∏ï‡∏±‡∏ß:</span>
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${result.itemsTotal.toFixed(2)} ‡∏ø</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏£‡πà‡∏ß‡∏°:</span>
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${result.sharedAmount.toFixed(2)} ‡∏ø</span>
              </div>
            </div>
            <div style="background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color}); padding: 16px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
              <span style="color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700;">üí≥ ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢:</span>
              <span style="color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800;">${result.total.toFixed(2)} ‡∏ø</span>
            </div>
          </div>
        `;
      });

      html += '</div>';
      resultsContainer.innerHTML = html;
    }

    function showToast(message, color) {
      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${color};
        color: white;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        z-index: 1000;
        font-weight: 600;
        animation: fadeIn 0.3s ease-in;
      `;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        toast.style.transition = 'all 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function resetForm() {
      people = [];
      items = [];
      totalAmount = 0;
      if (document.getElementById('total-amount')) {
        document.getElementById('total-amount').value = '';
      }
      renderPeople();
      renderItems();
      const resultsContainer = document.getElementById('results-container');
      if (resultsContainer) {
        resultsContainer.innerHTML = '';
      }
    }

    function renderPaymentPage() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Inter, Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
      
      return `
        <main style="max-width: 800px; margin: 0 auto;">
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
            <div style="display: flex; align-items: center; margin-bottom: 32px;">
              <button 
                onclick="backToMain()"
                style="width: 44px; height: 44px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: none; border-radius: 50%; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0;"
              >‚Üê</button>
              <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">üí≥ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>
            </div>

            <div style="background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}10, ${config.secondary_action_color || defaultConfig.secondary_action_color}10); border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; line-height: 1.6;">
                <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô PromptPay, ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, True Money Wallet ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
              </div>
            </div>

            <div id="payment-methods-container" style="margin-bottom: 24px;"></div>

            <button 
              onclick="addPaymentMethod()"
              style="width: 100%; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: 2px dashed ${config.primary_action_color || defaultConfig.primary_action_color}; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 24px;"
            >‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>

            <div style="display: flex; gap: 12px;">
              <button 
                onclick="backToMain()"
                style="flex: 1; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700;"
              >‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
              <button 
                onclick="savePaymentInfo()"
                style="flex: 1; padding: 14px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
              >üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
          </div>
        </main>
      `;
    }

    function renderContactPage() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      
      return `
        <main style="max-width: 800px; margin: 0 auto;">
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
            <div style="display: flex; align-items: center; margin-bottom: 32px;">
              <button 
                onclick="backToMain()"
                style="width: 44px; height: 44px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: none; border-radius: 50%; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0;"
              >‚Üê</button>
              <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">üìû ÔøΩÔøΩ‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h1>
            </div>

            <div style="background: linear-gradient(135deg, ${config.secondary_action_color || defaultConfig.secondary_action_color}10, ${config.primary_action_color || defaultConfig.primary_action_color}10); border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid ${config.secondary_action_color || defaultConfig.secondary_action_color};">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; line-height: 1.6;">
                <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ÔøΩÔøΩÔøΩ‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, Line ID, Facebook, Email, Instagram ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
              </div>
            </div>

            <div id="contact-methods-container" style="margin-bottom: 24px;"></div>

            <button 
              onclick="addContactMethod()"
              style="width: 100%; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: 2px dashed ${config.secondary_action_color || defaultConfig.secondary_action_color}; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 24px;"
            >‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>

            <div style="display: flex; gap: 12px;">
              <button 
                onclick="backToMain()"
                style="flex: 1; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700;"
              >‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
              <button 
                onclick="saveContactInfo()"
                style="flex: 1; padding: 14px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
              >üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
          </div>
        </main>
      `;
    }

    function renderPeople() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const container = document.getElementById('people-container');
      
      if (people.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 3}px; margin-bottom: 12px;">üë•</div>
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô</div>
          </div>
        `;
        return;
      }

      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">';
      people.forEach((person, index) => {
        html += `
          <div class="card-hover" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 10px; padding: 16px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
              <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; flex-shrink: 0;">${index + 1}</span>
              <input 
                type="text" 
                value="${person.name}" 
                onchange="updatePersonName(${person.id}, this.value)"
                aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô"
                style="flex: 1; padding: 6px 10px; border: 2px solid white; border-radius: 6px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; min-width: 0;"
              />
            </div>
            <button 
              onclick="removePerson(${person.id})"
              aria-label="‡∏•‡∏ö‡∏Ñ‡∏ô"
              style="width: 100%; padding: 6px 12px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
            >üóëÔ∏è ‡∏•‡∏ö</button>
          </div>
        `;
      });
      html += '</div>';

      container.innerHTML = html;
    }

    function renderItems() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const container = document.getElementById('items-container');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 3}px; margin-bottom: 12px;">üçΩÔ∏è</div>
            <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
          </div>
        `;
        return;
      }

      let html = '';
      items.forEach((item, index) => {
        const icon = item.type === 'food' ? 'üçΩÔ∏è' : 'ü•§';
        html += `
          <div class="card-hover slide-in" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); border-left: 4px solid ${item.type === 'food' ? config.primary_action_color || defaultConfig.primary_action_color : config.secondary_action_color || defaultConfig.secondary_action_color};">
            <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px;">
                <label for="item-name-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                <input 
                  id="item-name-${item.id}"
                  type="text" 
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢, ‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°" 
                  value="${item.name}"
                  onchange="updateItemName(${item.id}, this.value)"
                  aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                  style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
                />
              </div>
              <div style="width: 120px;">
                <label for="item-price-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                <input 
                  id="item-price-${item.id}"
                  type="number" 
                  placeholder="0.00" 
                  value="${item.price || ''}"
                  onchange="updateItemPrice(${item.id}, this.value)"
                  aria-label="‡∏£‡∏≤‡∏Ñ‡∏≤"
                  style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 700;"
                />
              </div>
              <div style="width: 140px;">
                <label for="item-type-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <select 
                  id="item-type-${item.id}"
                  onchange="updateItemType(${item.id}, this.value)"
                  aria-label="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                  style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; cursor: pointer; background: white;"
                >
                  <option value="food" ${item.type === 'food' ? 'selected' : ''}>üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                  <option value="drink" ${item.type === 'drink' ? 'selected' : ''}>ü•§ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                </select>
              </div>
              <div style="display: flex; align-items: flex-end;">
                <button 
                  onclick="removeItem(${item.id})"
                  aria-label="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                  style="padding: 10px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; height: 42px;"
                >üóëÔ∏è</button>
              </div>
            </div>
        `;

        if (people.length > 0) {
          html += `
            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 16px; border-radius: 8px;">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 12px;">‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ? (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô)</div>
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px;">
          `;
          
          people.forEach(person => {
            const isChecked = item.consumers.includes(person.id);
            html += `
              <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border-radius: 6px; cursor: pointer; border: 2px solid ${isChecked ? config.primary_action_color || defaultConfig.primary_action_color : 'transparent'};">
                <input 
                  type="checkbox" 
                  ${isChecked ? 'checked' : ''}
                  onchange="toggleConsumer(${item.id}, ${person.id})"
                  class="checkbox-custom"
                  aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${person.name}"
                />
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${person.name}</span>
              </label>
            `;
          });
          
          html += `
              </div>
            </div>
          `;
        } else {
          html += `
            <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 16px; border-radius: 8px; text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">
              ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ
            </div>
          `;
        }

        html += `
          </div>
        `;
      });

      container.innerHTML = html;
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Inter, Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      
      const wrapper = document.getElementById('app-wrapper');
      if (wrapper) {
        wrapper.style.background = config.background_color || defaultConfig.background_color;
        wrapper.style.minHeight = '100%';
        wrapper.style.padding = '40px 20px';
      }
      
      const container = document.getElementById('main-container');
      if (container) {
        container.style.background = config.surface_color || defaultConfig.surface_color;
      }
      
      const title = document.getElementById('app-title');
      if (title) {
        title.textContent = config.app_title || defaultConfig.app_title;
        title.style.color = config.text_color || defaultConfig.text_color;
        title.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 2}px`;
      }
      
      const subtitle = document.getElementById('app-subtitle');
      if (subtitle) {
        subtitle.textContent = config.app_subtitle || defaultConfig.app_subtitle;
        subtitle.style.color = config.text_color || defaultConfig.text_color;
        subtitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
      }
      
      const totalLabel = document.getElementById('total-label');
      if (totalLabel) {
        totalLabel.textContent = config.total_amount_label || defaultConfig.total_amount_label;
        totalLabel.style.color = config.text_color || defaultConfig.text_color;
        totalLabel.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
      }
      
      const peopleTitle = document.getElementById('people-section-title');
      if (peopleTitle) {
        peopleTitle.textContent = config.people_section_title || defaultConfig.people_section_title;
        peopleTitle.style.color = config.text_color || defaultConfig.text_color;
        peopleTitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.25}px`;
      }
      
      const itemsTitle = document.getElementById('items-section-title');
      if (itemsTitle) {
        itemsTitle.textContent = config.items_section_title || defaultConfig.items_section_title;
        itemsTitle.style.color = config.text_color || defaultConfig.text_color;
        itemsTitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.25}px`;
      }
      
      const addPersonBtn = document.getElementById('add-person-btn');
      if (addPersonBtn) {
        addPersonBtn.textContent = config.add_person_button || defaultConfig.add_person_button;
        addPersonBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
        addPersonBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
      }
      
      const addItemBtn = document.getElementById('add-item-btn');
      if (addItemBtn) {
        addItemBtn.textContent = config.add_item_button || defaultConfig.add_item_button;
        addItemBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
        addItemBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
      }
      
      const viewSummaryBtn = document.getElementById('view-summary-btn');
      if (viewSummaryBtn) {
        viewSummaryBtn.textContent = config.view_summary_button || defaultConfig.view_summary_button;
        viewSummaryBtn.style.background = 'white';
        viewSummaryBtn.style.color = config.text_color || defaultConfig.text_color;
        viewSummaryBtn.style.border = `2px solid ${config.text_color || defaultConfig.text_color}20`;
        viewSummaryBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
      }

      const managePaymentBtn = document.getElementById('manage-payment-btn');
      if (managePaymentBtn) {
        managePaymentBtn.style.background = 'white';
        managePaymentBtn.style.color = config.text_color || defaultConfig.text_color;
        managePaymentBtn.style.border = `2px solid ${config.text_color || defaultConfig.text_color}20`;
      }

      const manageContactBtn = document.getElementById('manage-contact-btn');
      if (manageContactBtn) {
        manageContactBtn.style.background = 'white';
        manageContactBtn.style.color = config.text_color || defaultConfig.text_color;
        manageContactBtn.style.border = `2px solid ${config.text_color || defaultConfig.text_color}20`;
      }

      const calculateBtn = document.getElementById('calculate-btn');
      if (calculateBtn) {
        calculateBtn.textContent = config.calculate_button || defaultConfig.calculate_button;
        calculateBtn.style.background = `linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color})`;
        calculateBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
      }
      
      const resetBtn = document.getElementById('reset-btn');
      if (resetBtn) {
        resetBtn.textContent = config.reset_button || defaultConfig.reset_button;
        resetBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
        resetBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size)}px`;
      }

      const totalInput = document.getElementById('total-amount');
      if (totalInput) {
        totalInput.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
        totalInput.style.color = config.text_color || defaultConfig.text_color;
      }
      
      renderPeople();
      renderItems();
    }

    function renderApp() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const wrapper = document.getElementById('app-wrapper');
      wrapper.style.background = config.background_color || defaultConfig.background_color;

      if (currentView === 'payment') {
        wrapper.innerHTML = renderPaymentPage();
        setTimeout(() => renderPaymentMethodsEdit(), 0);
        return;
      }

      if (currentView === 'contact') {
        wrapper.innerHTML = renderContactPage();
        setTimeout(() => renderContactMethodsEdit(), 0);
        return;
      }

      if (currentView === 'summary') {
        wrapper.innerHTML = renderSummaryPage();
        return;
      }

      renderMainView();
    }

    function renderMainView() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Inter, Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      const wrapper = document.getElementById('app-wrapper');
      wrapper.style.background = config.background_color || defaultConfig.background_color;
      
      wrapper.innerHTML = `
        <main style="max-width: 1000px; margin: 0 auto;">
          <div id="main-container" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 36px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
            <header style="text-align: center; margin-bottom: 36px;">
              <h1 id="app-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0 0 12px 0;">${config.app_title || defaultConfig.app_title}</h1>
              <p id="app-subtitle" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin: 0; opacity: 0.7;">${config.app_subtitle || defaultConfig.app_subtitle}</p>
            </header>

            <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
              <button 
                id="view-summary-btn"
                onclick="openSummaryModal()"
                style="flex: 1; min-width: 150px; padding: 12px 16px; background: white; color: ${config.text_color || defaultConfig.text_color}; border: 2px solid ${config.text_color || defaultConfig.text_color}20; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.05);"
              >${config.view_summary_button || defaultConfig.view_summary_button}</button>
              <button 
                id="manage-payment-btn"
                onclick="openPaymentPage()"
                style="flex: 1; min-width: 150px; padding: 12px 16px; background: white; color: ${config.text_color || defaultConfig.text_color}; border: 2px solid ${config.text_color || defaultConfig.text_color}20; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.05);"
              >üí≥ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
              <button 
                id="manage-contact-btn"
                onclick="openContactPage()"
                style="flex: 1; min-width: 150px; padding: 12px 16px; background: white; color: ${config.text_color || defaultConfig.text_color}; border: 2px solid ${config.text_color || defaultConfig.text_color}20; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.05);"
              >üìû ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>
            </div>

            <div style="margin-bottom: 32px;">
              <label id="total-label" for="total-amount" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 10px;">${config.total_amount_label || defaultConfig.total_amount_label}</label>
              <input 
                type="number" 
                id="total-amount" 
                placeholder="0.00"
                aria-label="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                style="width: 100%; padding: 14px 18px; border: 3px solid ${config.background_color || defaultConfig.background_color}; border-radius: 10px; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 700;"
              />
            </div>

            <div style="margin-bottom: 32px; background: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="people-section-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 800; margin: 0;">${config.people_section_title || defaultConfig.people_section_title}</h2>
                <button 
                  id="add-person-btn"
                  onclick="addPerson()"
                  style="padding: 10px 20px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
                >${config.add_person_button || defaultConfig.add_person_button}</button>
              </div>
              <div id="people-container"></div>
            </div>

            <div style="margin-bottom: 32px; background: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="items-section-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 800; margin: 0;">${config.items_section_title || defaultConfig.items_section_title}</h2>
                <button 
                  id="add-item-btn"
                  onclick="addItem()"
                  style="padding: 10px 20px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
                >${config.add_item_button || defaultConfig.add_item_button}</button>
              </div>
              <div id="items-container"></div>
            </div>

            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button 
                id="calculate-btn"
                onclick="calculateSplit()"
                style="flex: 2; min-width: 200px; padding: 18px; background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}, ${config.secondary_action_color || defaultConfig.secondary_action_color}); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 800; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
              >${config.calculate_button || defaultConfig.calculate_button}</button>
              <button 
                id="reset-btn"
                onclick="resetForm()"
                style="padding: 18px 28px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
              >${config.reset_button || defaultConfig.reset_button}</button>
            </div>

            <div id="results-container"></div>
          </div>
        </main>
      `;

      renderPeople();
      renderItems();
    }

    async function initApp() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
            ["total_amount_label", config.total_amount_label || defaultConfig.total_amount_label],
            ["people_section_title", config.people_section_title || defaultConfig.people_section_title],
            ["add_person_button", config.add_person_button || defaultConfig.add_person_button],
            ["items_section_title", config.items_section_title || defaultConfig.items_section_title],
            ["add_item_button", config.add_item_button || defaultConfig.add_item_button],
            ["calculate_button", config.calculate_button || defaultConfig.calculate_button],
            ["reset_button", config.reset_button || defaultConfig.reset_button],
            ["summary_title", config.summary_title || defaultConfig.summary_title],
            ["view_summary_button", config.view_summary_button || defaultConfig.view_summary_button],
            ["contact_title", config.contact_title || defaultConfig.contact_title],
            ["contact_method_1", config.contact_method_1 || defaultConfig.contact_method_1],
            ["contact_detail_1", config.contact_detail_1 || defaultConfig.contact_detail_1],
            ["contact_method_2", config.contact_method_2 || defaultConfig.contact_method_2],
            ["contact_detail_2", config.contact_detail_2 || defaultConfig.contact_detail_2]
          ])
        });
      }

      renderMainView();
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a792f6f266bd03c',t:'MTc2NDY2MTMyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
